FROM ubuntu:20.04
LABEL author="liaokangning <lkangn.collin@gmail.com>"
LABEL describe="use for build UGW project"

# 设置时区
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# sh 修改为 bash, 默认为 dash
RUN rm /bin/sh && ln -s /bin/bash /bin/sh

# 增加 32 位支持
RUN dpkg --add-architecture i386

# 修改下载源
RUN sed -i 's@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g' /etc/apt/sources.list.d/ubuntu.sources; \
	sed -i 's/security.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list.d/ubuntu.sources;

RUN apt-get update && apt-get install ca-certificates --reinstall -y

# 使用 HTTPS 可以有效避免国内运营商的缓存劫持
RUN sed -i 's/http:/https:/g' /etc/apt/sources.list.d/ubuntu.sources

# 安装相关编译环境软件
RUN apt-get update && apt-get install -y \
	python3 \
	vim \
	ubuntu-make make\
	gcc \
	patch \
	rsync \
	bison \
	flex \
	device-tree-compiler \
	cmake \
	u-boot-tools \
	libssl-dev \
	bc \
	unzip \
	autoconf \
	automake \
	cpio \
	kmod \
	python3-pip \
	pkg-config \
	mtd-utils \
	libtool \
	squashfs-tools \
	ccache \
	libmpc-dev \
	libgmp-dev \
	libncurses5-dev 

# 开发工具
RUN apt-get install -y \
	bear

RUN pip3 install \
	pyelftools==0.30 \
	pycryptodomex \
	pycryptodome \
	gmssl \
	kconfiglib \
	prettytable \
	sh

RUN cd scripts/python && ./install_python_pack.sh


WORKDIR /

RUN mkdir /projects && chown ubuntu:ubuntu /projects
